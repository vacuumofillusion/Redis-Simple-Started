# 4-数据库迭代器

Redis的数据库迭代器主要用于遍历存储在Redis中的数据结构，如列表（Lists）、集合（Sets）、有序集合（Sorted Sets）和哈希表（Hashes）等。这种遍历机制在处理大量数据时特别有用，因为它允许你以高效的方式逐步访问数据，而不是一次性将所有数据加载到内存中。这在处理大数据集或内存受限的环境中尤为重要。

SCAN命令：Redis提供了SCAN命令作为迭代器的一种实现方式，用于遍历数据库中的键。SCAN命令通过游标（cursor）来逐步遍历键空间，支持模式匹配和限制返回结果的数量。
HSCAN、SSCAN和ZSCAN命令：这些命令分别用于遍历哈希表、集合和有序集合中的元素。它们与SCAN命令类似，也通过游标来遍历数据结构中的元素，并支持模式匹配和结果数量限制。

业务场景：
1. 用户关系管理：在社交媒体应用中，你可能需要遍历一个用户的所有关注者（可能存储在Redis的集合中），以发送通知或更新他们的状态。
2. 排行榜处理：在游戏或应用中，你可能需要遍历有序集合来显示排行榜，如最高分玩家列表。
3. 数据迁移或备份：在需要将Redis中的数据迁移到另一个系统或进行备份时，迭代器允许你逐步遍历并处理数据，而不是一次性加载所有数据。

## 示例代码

```python
import redis  
  
# 连接到Redis  
r = redis.Redis(host='localhost', port=6379)  
  
# 假设我们在Redis中存储了一些键  
# 这里我们先插入一些示例键（在实际应用中，这些键可能是动态生成的）  
for i in range(100):  
    r.set(f'key:{i}', f'value_{i}')  
  
# 使用SCAN迭代器遍历键  
cursor = '0'  # 游标初始化为0  
while cursor != 0:  
    # SCAN命令返回两个值：游标和键的列表  
    cursor, keys = r.scan(cursor=cursor, match='key:*', count=10)  
    for key in keys:  
        print(key)  # 将字节字符串解码为普通字符串  
  
# 注意：SCAN命令的count参数是一个提示，告诉Redis我们希望每次迭代返回多少个元素。  
# 但Redis可能会返回更多或更少的元素，具体取决于内部实现和数据集的大小。  
# 因此，我们需要检查游标是否为零来结束迭代。
```